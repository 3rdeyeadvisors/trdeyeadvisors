<!DOCTYPE html>
<html>
<head>
    <title>Generating 3EA Banner</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
        #result { margin-top: 20px; }
        img { max-width: 100%; border: 1px solid #ccc; margin: 10px 0; }
        .download-btn { 
            display: inline-block; 
            padding: 10px 20px; 
            background: #007bff; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px; 
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Generating 3EA Social Banner...</h1>
    <div id="status">Calling OpenAI API...</div>
    <div id="result"></div>
    
    <script>
    async function generateBanner() {
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');
        
        try {
            statusDiv.textContent = 'Generating banner with AI...';
            
            const response = await fetch('https://zapbkuaejvzpqerkkcnc.supabase.co/functions/v1/generate-social-banner', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphcGJrdWFlanZ6cHFlcmtrY25jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NjAxMTksImV4cCI6MjA2ODUzNjExOX0.kmzeGjrbpI2qB5UhKoAOoEspxWYGk8UthowEA_f154o'
                },
                body: JSON.stringify({
                    prompt: "Create a professional futuristic social media banner for '3EA' (3rd Eye Advisors) decentralized learning hub. The design should feature: - Large prominent '3EA' text in bold, modern font - Subtitle 'Decentralized Learning Hub' - A network of glowing interconnected bubbles/nodes representing decentralized knowledge - Deep blue and purple gradient background with subtle tech patterns - Holographic effects and lens flares - Professional web3/crypto aesthetic with clean typography - Banner dimensions optimized for social sharing (1792x1024) - High contrast text for readability",
                    size: "1792x1024",
                    quality: "high"
                })
            });

            statusDiv.textContent = 'Processing response...';
            const data = await response.json();
            console.log('Response:', data);
            
            if (data.data && data.data[0]) {
                const imageData = data.data[0];
                let imageUrl;
                
                // Handle different response formats
                if (imageData.url) {
                    imageUrl = imageData.url;
                } else if (imageData.b64_json) {
                    imageUrl = `data:image/webp;base64,${imageData.b64_json}`;
                } else {
                    throw new Error('No image data found in response');
                }
                
                statusDiv.textContent = 'Banner generated successfully!';
                
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = '3EA Social Banner';
                resultDiv.appendChild(img);
                
                // Create download link
                const downloadLink = document.createElement('a');
                downloadLink.href = imageUrl;
                downloadLink.download = '3ea-social-banner.webp';
                downloadLink.className = 'download-btn';
                downloadLink.textContent = 'Download Banner (3ea-social-banner.webp)';
                resultDiv.appendChild(downloadLink);
                
                const instructions = document.createElement('div');
                instructions.innerHTML = `
                    <p><strong>Next Steps:</strong></p>
                    <ol style="text-align: left; max-width: 600px; margin: 20px auto;">
                        <li>Click "Download Banner" to save the image</li>
                        <li>Save it as "3ea-social-banner.webp" in your project's public folder</li>
                        <li>The social meta tags are already updated to use this banner</li>
                        <li>Test sharing your website link on social media to see the banner</li>
                    </ol>
                `;
                resultDiv.appendChild(instructions);
                
            } else {
                throw new Error('Invalid response format: ' + JSON.stringify(data));
            }
        } catch (error) {
            console.error('Error:', error);
            statusDiv.textContent = 'Error generating banner';
            resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p><pre>${JSON.stringify(error, null, 2)}</pre>`;
        }
    }
    
    // Generate immediately when page loads
    generateBanner();
    </script>
</body>
</html>